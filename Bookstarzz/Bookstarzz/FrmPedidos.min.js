var tablaPedidosDT,cadenaCliente;function validaURL(){1!=$("#txtURL").val()&&window.location.replace("FrmBookstarzz.aspx")}function limpiar(){$("#contenidoVista").empty()}function cargarPedidos(){Bookstarzz.ws.WSPedidos.getAllPedidos(function(t){t?cargarDatos(JSON.parse(t)):window.location.replace("FrmLogin.aspx")},function(t){window.scrollTo(0,0),$("#txtMsg").val("2"),mensaje()})}function cargarDatos(t){normalizar(t),tablaPedidosDT=$("#tblPedidos").dataTable({select:!0,language:{decimal:"",emptyTable:"No hay información",info:"Mostrando _START_ a _END_ de _TOTAL_ libros",infoEmpty:"Mostrando 0 a 0 de 0 libros",infoFiltered:"(Filtrado de _MAX_ total libros)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ libros",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"Sin resultados encontrados",paginate:{first:"Primero",last:"Ultimo",next:"Siguiente",previous:"Anterior"}},data:t,columnDefs:[{width:"5%",targets:[0]},{width:"35%",targets:[1,2]},{width:"10%",targets:[3]},{width:"5%",targets:[4]},{width:"20%",targets:[5]},{width:"20%",targets:[6]}],columns:[{title:"FOLIO",data:"idPedido"},{title:"Cliente",data:"idUsuario"},{title:"Direccion",data:"direccion"},{title:"Ciudad",data:"ciudad"},{title:"Formato",data:"formato"},{title:"Fecha de compra",data:"fechaCompra"},{title:"Estatus del pedido",data:"estatusPedido"}]}),$("#tblPedidos tbody").on("click","tr",function(){deshabilitaBtn();const t=$(this).find("td").first().text();"preparado"==$(this).find("td").last().text()&&$("#btnEntregado").attr("disabled",!1),cadenaCliente=$(this).find("td:eq(1)").text(),llenarDetallePedido(t)})}function moverEstatus(t){$("#spnFolio").text(t),$("#mdlConfirmar").modal()}function cofirmMoverEstatus(){$("#mdlConfirmar").modal("hide"),modificarEstatus("entregado")}function deshabilitaBtn(){$("#btnEntregado").attr("disabled",!0)}function llenarDetallePedido(t){$("#body_bloque_2_txtDetallesPedido").text(""),Bookstarzz.ws.WSPedidos.getOne(t,function(a){if(a){const o="\r\n";let e=normalizar(JSON.parse(a)),i=e.direccion,d=e.ciudad,n=e.formato,s=e.idPedido,r=e.fechaCompra,l=e.estatusPedido;$("#body_bloque_2_txtDetallesPedido").html("DIRECCION: "+i+o+"CIUDAD: "+d+o+"FORMATO: "+n+o+"FOLIO: "+s+o+"FECHA DE COMPRA: "+r+o+"ESTATUS DEL PEDIDO: "+l),$("#txtIdPedido").val(t)}else window.location.replace("FrmLogin.aspx")},function(t){window.scrollTo(0,0),$("#txtMsg").val("2"),mensaje()})}function normalizar(t){var a=[];for(let o=0;o<t.length;o++)t[o].fechaCompra=moment(t[o].fechaCompra).format("YYYY-MM-DD"),a[o]=t[o].idUsuario;return t.fechaCompra=moment(t.fechaCompra).format("YYYY-MM-DD"),t}function modificarEstatus(t){const a=$("#txtIdPedido").val();let o={};"entregado"==t&&(o.idPedido=a,o.estatusPedido=t,Bookstarzz.ws.WSPedidos.updateEstatusPedido(JSON.stringify(o),function(t){1==t?(recargarDatos(),deshabilitaBtn(),window.scrollTo(0,0),$("#txtMsg").val("1"),mensaje()):window.location.replace("FrmLogin.aspx")},function(t){window.scrollTo(0,0),$("#txtMsg").val("2"),mensaje()}))}function recargarDatos(){tablaPedidosDT.fnClearTable(),Bookstarzz.ws.WSPedidos.getAllPedidos(function(t){if(t){let a=JSON.parse(t);llenarDetallePedido($("#txtIdPedido").val()),tablaPedidosDT.fnAddData(normalizar(a))}else window.location.replace("FrmLogin.aspx")},function(t){window.scrollTo(0,0),$("#txtMsg").val("2"),mensaje()})}function mensaje(){const t=$("#txtMsg").val();1==t&&($("#cntMsg").text("El pedido paso de PREPARADO a ENTREGADO con éxito"),$("#divMsg").addClass("alert-success"),$("#divMsg").css("display","block"),setTimeout(function(){$("#divMsg").css("display","none").fadeOut()},3e3)),2==t&&($("#tipoMsg").text("Error: "),$("#cntMsg").text("Ha ocurrido un problema interno al intentar obtener la informacion"),$("#divMsg").addClass("alert-danger"),$("#divMsg").css("display","block"))}$(document).ready(function(){validaURL(),$("#divBloque2").removeClass("col-10"),$("#divBloque1").removeClass("col-2 pr-0"),$("#divBloque2").addClass("container-fluid"),$("#divBloque1").addClass("col"),deshabilitaBtn(),$("#btnConfirmarAccion").click(cofirmMoverEstatus),$("#btnEntregado").click(function(){moverEstatus($("#txtIdPedido").val())}),cargarPedidos()});