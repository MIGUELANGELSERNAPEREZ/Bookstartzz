var tablaPedidosDT,libroMsgGeneral,idGlobal;function validaURL(){1!=$("#txtURL").val()&&window.location.replace("FrmBookstarzz.aspx")}function limpiar(){$("#contenidoVista").empty()}function cargarPedidos(){Bookstarzz.ws.WSLibros.getAll(function(i){i?cargarDatos(JSON.parse(i)):window.location.replace("FrmLogin.aspx")},function(i){$("#txtMsg").val("2"),window.scrollTo(0,0),mensaje()})}function normalizar(i){for(let a=0;a<i.length;a++)i[a].FechaPublicacion=moment(i[a].FechaPublicacion).format("YYYY-MM-DD"),1==i[a].Clasificacion&&(i[a].Clasificacion="Niños"),2==i[a].Clasificacion&&(i[a].Clasificacion="Adolescentes"),3==i[a].Clasificacion&&(i[a].Clasificacion="Adultos");return i}function cargarDatos(i){normalizar(i),tablaPedidosDT=$("#tblGestionTitulos").dataTable({language:{decimal:"",emptyTable:"No hay información",info:"Mostrando _START_ a _END_ de _TOTAL_ libros",infoEmpty:"Mostrando 0 a 0 de 0 libros",infoFiltered:"(Filtrado de _MAX_ total libros)",infoPostFix:"",thousands:",",lengthMenu:"Mostrar _MENU_ libros",loadingRecords:"Cargando...",processing:"Procesando...",search:"Buscar:",zeroRecords:"Sin resultados encontrados",paginate:{first:"Primero",last:"Ultimo",next:"Siguiente",previous:"Anterior"}},data:i,columnDefs:[{width:"5%",targets:[0]},{width:"10%",targets:[1,2]},{width:"15%",targets:[3]},{width:"20%",targets:[4]},{width:"5%",targets:[5,6,7,8]},{width:"20%",targets:[9]}],columns:[{title:"ID",data:"IdLibro"},{title:"Nombre",data:"Nombre"},{title:"Autor",data:"Autor"},{title:"ISBN",data:"ISBN"},{title:"Fecha de publicación",data:"FechaPublicacion"},{title:"Precio",data:"Presio"},{title:"Páginas",data:"NPaginas"},{title:"Visitas",data:"Visitas"},{title:"Clasificación",data:"Clasificacion"},{title:"",data:null,render:function(i,a,t){return'<div class="row justify-content-center"><button type="button" onclick="editar('+i.IdLibro+')" class="btn btn-primary">Editar</button><button type="button" onclick="eliminar('+i.IdLibro+", '"+i.Nombre+'\')" class="btn btn-danger">Eliminar</button></div>'}}]})}function editar(i){limpiar(),$("#contenidoVista").load("FrmGestionTitulosCRUD.aspx",{inpIdLibro:i,txtURL:1})}function eliminar(i,a){$("#inpIdLibro").val(i),$("#spnLibro").text(a),$("#mdlConfirmar").modal()}function cofirmEliminar(){libroMsgGeneral=$("#spnLibro").text(),$("#mdlConfirmar").modal("hide");let i=$("#inpIdLibro").val();Bookstarzz.ws.WSLibros.deleteLibro(i,function(i){i?(recargarDatos(),$("#txtMsg").val("3"),window.scrollTo(0,0),mensaje()):($("#txtMsg").val("2"),window.scrollTo(0,0),mensaje())},function(i){window.location.replace("FrmLogin.aspx")})}function recargarDatos(){tablaPedidosDT.fnClearTable(),Bookstarzz.ws.WSLibros.getAll(function(i){if(i){let a=JSON.parse(i);tablaPedidosDT.fnAddData(normalizar(a))}else window.location.replace("FrmLogin.aspx")},function(i){$("#txtMsg").val("2"),window.scrollTo(0,0),mensaje()})}function mensaje(){const i=$("#txtMsg").val();1==i&&(idGlobal=$("#txtIdGlobal").val(),$("#cntMsg").text("El registro '"+idGlobal+"' se modificó exitosamente"),$("#divMsg").addClass("alert-success"),$("#divMsg").css("display","block"),setTimeout(function(){$("#divMsg").css("display","none").fadeOut()},3e3)),2==i&&($("#tipoMsg").text("Error: "),$("#cntMsg").text("Ha ocurrido un problema interno al intentar obtener/manipular la informacion"),$("#divMsg").addClass("alert-danger"),$("#divMsg").css("display","block")),3==i&&($("#cntMsg").text("El libro '"+libroMsgGeneral+"' se eliminó exitosamente"),$("#divMsg").addClass("alert-success"),$("#divMsg").css("display","block"),setTimeout(function(){$("#divMsg").css("display","none").fadeOut()},3e3))}$(document).ready(function(){validaURL(),$("#divBloque2").removeClass("col-10"),$("#divBloque1").removeClass("col-2 pr-0"),$("#divBloque2").addClass("container-fluid"),$("#divBloque1").addClass("col"),cargarPedidos(),$("#btnAgregar").click(function(){limpiar(),$("#contenidoVista").load("FrmGestionTitulosCRUD.aspx",{txtURL:1})}),$("#btnConfirmarEliminar").click(cofirmEliminar),mensaje()});