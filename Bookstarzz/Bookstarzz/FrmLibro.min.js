var idLibro,titulo,autor,precio;function llenarDatos(o){if(null!=o){quitarEspacios(o);Bookstarzz.ws.WSLibros.traerLibro(o,function(o){if($("#contenidoVista").load("FrmMenu.aspx",{typeError:"Libro no disponible"}),o){let t=normalizar(JSON.parse(o));btnDescargar(t.Nombre),$("#titulo").html(t.Nombre),$("#ano").html(t.FechaPublicacion),$("#genero").html(t.Nombre),$("#autor").html(t.Autor),$("#sinopsis").html(t.Descripcion),$("#paginas").html(t.NPaginas),$("#presio").html(t.Presio),1==t.Clasificacion?$("#clasificacion").html("Niños"):2==t.Clasificacion?$("#clasificacion").html("Adolecentes"):3==t.Clasificacion&&$("#clasificacion").html("Adultos");let i=quitarEspacios(t.Nombre);$(".card-img-top").attr("src","libros/"+i+".jpg").attr("id",t.IdLibro)}else $("#contenidoVista").load("FrmMenu.aspx",{typeError:"Libro no disponible"})},function(o){$("#contenidoVista").load("FrmLogin.aspx",{typeError:"Libro no disponible"})})}else $("#cntMsg").text("Error: No se pudo cargar la informacion del libro seleccionado"),$("#cntMsg").parent().show()}$(document).ready(function(){if(window.scrollTo(0,0),parseInt($("#txtId").val())>0)infoLibro($("#txtId").val());else if(0!=$("#txtBuscar").val()){llenarDatos($("#txtBuscar").val())}else $("#contenidoVista").load("FrmMenu.aspx",{typeError:"Libro no disponible"})});var crear=!1;function leerLibro(){if(crear)$(".container-pdf").slideToggle(1e3);else{crear=!0;let o=quitarEspacios($("#titulo").html());$(".container-pdf").css({width:"100%",height:"900px"}),$(".container-pdf").append($("<embed>").attr("id","vista").attr("type","application/pdf").attr("src","pdfs/"+o+".pdf").css({width:"100%",height:"100%"}));let t=0;parseInt($("#txtId").val())>0?t=parseInt($("#txtId").val()):parseInt($("#txtBuscar").val())>0&&(t=parseInt($("#txtBuscar").val())),Bookstarzz.ws.WSLibros.insertVisita(t,function(o){1==o?($(".toast").toast("show"),$("#toastMostrar").toast("show")):($("#cntMsg").text("Error: No sea podido tomar encuenta su lectura"),$("#cntMsg").parent().show())},function(o){"System.Security.SecurityException"==o._exceptionType?window.location.replace("FrmLogin.aspx"):($("#cntMsg").text("Error: No se a podido encontrar el libro"),$("#cntMsg").parent().show())})}}function normalizar(o){return o.FechaPublicacion=moment(o.FechaPublicacion).format("YYYY-MM-DD"),o}function quitarEspacios(o){let t="";for(var i=0;i<o.length;i++)" "!=o[i]&&(t+=o[i]);return t}function infoLibro(o){Bookstarzz.ws.WSLibros.getOne(o,function(o){if(o){let i=normalizar(JSON.parse(o)),r="";btnDescargar(i.Nombre),$("#titulo").html(i.Nombre),$("#ano").html(i.FechaPublicacion),$("#genero").html(i.Nombre),$("#autor").html(i.Autor),$("#sinopsis").html(i.Descripcion),$("#paginas").html(i.NPaginas),$("#presio").html(i.Presio),idLibro=$("#txtId").val(),titulo=i.Nombre,autor=i.Autor,precio=i.Presio,1==i.Clasificacion?$("#clasificacion").html("Niños"):2==i.Clasificacion?$("#clasificacion").html("Adolecentes"):3==i.Clasificacion&&$("#clasificacion").html("Adultos");for(var t=0;t<i.Nombre.length;t++)" "!=i.Nombre[t]&&(r+=i.Nombre[t]);$(".card-img-top").attr("src","libros/"+r+".jpg").attr("id",i.IdLibro)}else $("#contenidoVista").load("FrmMenu.aspx",{typeError:"Ha abido un error al extraer la informacion del libro"})},function(o){"System.Security.SecurityException"==o._exceptionType?window.location.replace("FrmLogin.aspx"):$("#contenidoVista").load("FrmMenu.aspx",{typeError:"Error: El ejemplar no se encuentra disponible en estos momentos"})})}function btnDescargar(o){if(null!=o){let t=quitarEspacios(o);$("#btnDescargar").attr("download",t).attr("href","pdfs/"+t+".pdf")}else $("#cntMsg").text("Error: A ocurrido un error al realizar la descarga"),$("#cntMsg").parent().show()}function limpiar(){$("#contenidoVista").empty()}function AgregarCarrito(){if(idUsuario=$("#txtIdUsuario").val(),"undefined"!=typeof Storage){var o=[],t={},i=!1;t.idLibro=idLibro,t.titulo=titulo,t.autor=autor,t.precio=precio,o=JSON.parse(localStorage.getItem("USUARIO"+idUsuario))||[];for(let t=0;t<o.length;t++)idLibro==o[t].idLibro&&(i=!0);i||(o.push(t),localStorage.setItem("USUARIO"+idUsuario,JSON.stringify(o))),limpiar(),$("#contenidoVista").load("FrmCarrito.aspx",{rqtxtIdLibro:idLibro,txtURL:1})}}