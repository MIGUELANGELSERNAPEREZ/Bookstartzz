var idLibroGlobal,idUsuario;function validaURL(){1!=$("#txtURL").val()&&window.location.replace("FrmBookstarzz.aspx")}function limpiar(){$("#contenidoVista").empty()}function deshabilitaBtn(){$("#btnComprar").hide(),$("#btnCancelar").hide()}function cargarCategorias(){Bookstarzz.ws.WSCategorias.getAll(crearSidebar,function(a){$("#cntMsg").text("Error: no se ha podido cargar la seccion de categorias de los libros"),$("#cntMsg").parent().show()})}function crearSidebar(a){if(a){JSON.parse(a).forEach(function(a){$(".list-group").append($("<a>").addClass("list-group-item list-group-item-action").html(a.nombreCategoria).attr("href","#"))})}else $("#cntMsg").text("Error: no se ha podido Cargar las categorias de los libros"),$("#cntMsg").parent().show()}function cofirmEliminar(){$("#mdlConfirmar").modal("hide"),eliminarLibro(idLibroGlobal)}function eliminarLibro(a){var i=$("#txtIdUsuario").val();if("undefined"!=typeof Storage){var r=[],t=a.replace(/\#/g,"");a=parseInt(t.replace(/\./g,","));r=JSON.parse(localStorage.getItem("USUARIO"+i))||[];for(var o=0;o<r.length;o++)if(r[o].idLibro&&r[o].idLibro==a){r.splice(o,1);break}longitud=r.length,localStorage.setItem("USUARIO"+i,JSON.stringify(r)),0==longitud?(localStorage.removeItem("USUARIO"+i),limpiar(),$("#divTamano").addClass("ajustarTamano"),deshabilitaBtn(),$("#contenidoVista").load("FrmCarrito.aspx",{rqtxtIdLibro:a,txtURL:1})):(limpiar(),$("#contenidoVista").load("FrmCarrito.aspx",{rqtxtIdLibro:a,txtURL:1}))}}function pintarPagina(){let a,i,r,t,o=JSON.parse(localStorage.getItem("USUARIO"+idUsuario));for(let l=0;l<o.length;l++){let s=o[l].idLibro;a=o[l].titulo,i=o[l].autor,r=o[l].precio,t=o[l].titulo.replace(/\s/g,"")+".jpg",$("#contenedorLibros").css("display","block"),$("#contenedorLibros").append('<div id="divCardLibros'+s+'" class="tblsDatatables"><div class="card" style="width: 97%;"><div class="card-body"><div class="mb-3" style="max-width: 80%;"><div class="row no-gutters"><div class="col-md-4"><img id="imgPortada" src="libros/'+t+'" class="card-img" alt="..."></div><div class="col-md-8"><div class="card-body-carrito"><h5 class="card-text" class="txtTitulo">Titulo: '+a+'</h5><p class="card-text" class="txtAutor">Autor: '+i+'</p><a href="#'+s+'" class="card-text eliminarCarrito"><small class="text-muted">Eliminar del carrito</small></a></div></div></div></div><div class="mb-3" style="max-width: 100%;" ><div class="row no-gutters"><div class="col-md-8"><div class="card-body"><h5 class="card-title precioLibro"><strong class="txtPrecio">Precio c/u<br/>$'+r+"</strong></h5></div></div></div></div></div></div><br /></div>")}}function obtenerLibros(){idUsuario=$("#txtIdUsuario").val(),"undefined"!=typeof Storage&&localStorage.length>0&&(null!=localStorage.getItem("USUARIO"+idUsuario)?($("#divTamano").removeClass("ajustarTamano"),$("#divTamano").addClass("ajustarTamanoSI"),pintarPagina()):deshabilitaBtn())}$(document).ready(function(){validaURL(),obtenerLibros(),$("#rqtxtIdLibro").val()>0&&$("#divTamano").removeClass("ajustarTamano"),0==localStorage.length&&deshabilitaBtn(),$("#btnCancelar").click(function(){limpiar(),window.location.replace("FrmBookstarzz.aspx",{txtURL:1})}),$("#btnConfirmarEliminar").click(cofirmEliminar),$(".eliminarCarrito").click(function(){idLibroGlobal=$(this).attr("href"),$("#mdlConfirmar").modal()}),cargarCategorias()});